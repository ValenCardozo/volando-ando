{% extends 'base.html' %}

{% load i18n %}

{% block title %}{% trans "Volando Ando - Reserva tu vuelo" %}{% endblock %}

{% block content %}
<div class="container py-5">
    {% if not user.is_authenticated %}
    <div class="jumbotron bg-light shadow-sm">
        <h1 class="display-4">{% trans "Bienvenido a Volando Ando" %}</h1>
        <p class="lead">{% trans "Tu plataforma para encontrar y reservar los mejores vuelos a los precios más competitivos." %}</p>
        <hr class="my-4">
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-3">
                    <div class="card-body">
                        <h3 class="card-title">{% trans "¿Qué ofrecemos?" %}</h3>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-plane-departure mr-2 text-primary"></i>{% trans "Amplia selección de vuelos nacionales e internacionales" %}</li>
                            <li><i class="fas fa-tags mr-2 text-primary"></i>{% trans "Precios competitivos y ofertas exclusivas" %}</li>
                            <li><i class="fas fa-clock mr-2 text-primary"></i>{% trans "Reservas rápidas y seguras" %}</li>
                            <li><i class="fas fa-medal mr-2 text-primary"></i>{% trans "Mejor servicio al cliente" %}</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h3 class="card-title">{% trans "Comienza ahora mismo" %}</h3>
                        <p>{% trans "Crea una cuenta o inicia sesión para acceder a todas las funcionalidades:" %}</p>
                        <div class="d-flex mt-4">
                            <a class="btn btn-primary btn-lg mr-3" href="{% url 'login' %}" role="button">{% trans "Iniciar Sesión" %}</a>
                            <a class="btn btn-outline-primary btn-lg" href="{% url 'register' %}" role="button">{% trans "Registrarse" %}</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="jumbotron bg-light shadow-sm">
                <h1 class="display-4">{% trans "¡Hola" %}, {{ user.username }}!</h1>
                <p class="lead">{% trans "¿A dónde te gustaría viajar hoy?" %}</p>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="fas fa-ticket-alt fa-3x text-primary mb-3"></i>
                    <h4  href="{% url 'my_flights' %}">{% trans "Mis Vuelos" %}</h4>
                    <p>{% trans "Accede a tus reservas y tickets" %}</p>
                    <a href="{% url 'my_flights' %}" class="btn btn-outline-primary">{% trans "Ver Mis Vuelos" %}</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="fas fa-map-marked-alt fa-3x text-primary mb-3"></i>
                    <h4>{% trans "Destinos Populares" %}</h4>
                    <p>{% trans "Descubre nuevos lugares para visitar" %}</p>
                    <a href="" class="btn btn-outline-primary">{% trans "Explorar Destinos" %}</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card shadow-sm h-100">
                <div class="card-body text-center">
                    <i class="fas fa-percentage fa-3x text-primary mb-3"></i>
                    <h4>{% trans "Ofertas Especiales" %}</h4>
                    <p>{% trans "No te pierdas nuestras mejores promociones" %}</p>
                    <a href="{% url 'offers' %}" class="btn btn-outline-primary">{% trans "Ver Ofertas" %}</a>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mb-4 mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">{% trans "Buscar Vuelos" %}</h4>
                </div>
                <div class="card-body">
                    <form class="row" method="get" action="">
                        <div class="col-md-4 mb-3">
                            <label for="id_origin">{% trans "Origen" %}</label>
                            {{ form.origin }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="id_destination">{% trans "Destino" %}</label>
                            {{ form.destination }}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="d-block">{% trans "Tipo de viaje" %}</label>
                            {{ form.trip_type }}
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="id_departure_date">{% trans "Fecha de ida" %}</label>
                            {{ form.departure_date }}
                        </div>
                        <div class="col-md-3 mb-3" id="return_date_container">
                            <label for="id_return_date">{% trans "Fecha de vuelta" %}</label>
                            {{ form.return_date }}
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="id_passengers">{% trans "Pasajeros" %}</label>
                            {{ form.passengers }}
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="id_seat_class">{% trans "Clase" %}</label>
                            {{ form.seat_class }}
                        </div>
                        <div class="col-12 text-center mt-2">
                            <button type="submit" class="btn btn-primary btn-lg">{% trans "Buscar Vuelos" %}</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% if flights is not None %}
    <div class="row justify-content-center mt-4 mb-5">
        <div class="col-lg-8">
            <div class="card border-primary shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">{% trans "Resultados de la búsqueda" %}</h5>
                </div>
                <div class="card-body">
                    {% if flights %}
                        <ul class="list-group list-group-flush">
                        {% for flight in flights %}
                            <li class="list-group-item mb-2">
                                <strong>{% trans "Vuelo" %} {{ flight.id }}</strong>: {{ flight.origin }} → {{ flight.destination }}<br>
                                <span class="text-muted">{{ flight.departure_time|date:'d/m/Y H:i' }} - {{ flight.arrival_time|date:'d/m/Y H:i' }}</span><br>
                                <span class="badge bg-info text-dark">{{ flight.get_status_display }}</span>
                                <span class="badge bg-success">${{ flight.base_price }}</span>
                                {% if user.is_authenticated %}
                                    {% if flight.id in user_reservations %}
                                        <span class="badge badge-warning float-end">{% trans "Ya reservado" %}</span>
                                    {% else %}
                                        <form method="post" action="{% url 'confirm_reservation_prompt' flight.id %}" class="d-inline-block float-end ms-2">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm btn-primary">{% trans "Reservar" %}</button>
                                        </form>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted float-end">{% trans "Inicia sesión para reservar" %}</span>
                                {% endif %}
                            </li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <p class="text-danger mb-0">{% trans "No se encontraron vuelos para los criterios seleccionados." %}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
{% endif %}
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const onewayRadio = document.getElementById('oneway');
        const roundtripRadio = document.getElementById('roundtrip');
        const returnDateContainer = document.getElementById('return_date_container');
        const returnDate = document.getElementById('return_date');
        
        // Función para actualizar el estado del campo de fecha de vuelta
        function updateReturnDate() {
            if (onewayRadio.checked) {
                returnDateContainer.style.opacity = '0.5';
                returnDate.disabled = true;
                returnDate.required = false;
            } else {
                returnDateContainer.style.opacity = '1';
                returnDate.disabled = false;
                returnDate.required = true;
            }
        }
        
        // Configuración inicial
        updateReturnDate();
        
        // Escuchar cambios en los radio buttons
        onewayRadio.addEventListener('change', updateReturnDate);
        roundtripRadio.addEventListener('change', updateReturnDate);
        
        // Establecer fechas mínimas para hoy
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('departure_date').setAttribute('min', today);
        document.getElementById('return_date').setAttribute('min', today);
        
        // Actualizar la fecha mínima de retorno cuando se cambia la fecha de ida
        document.getElementById('departure_date').addEventListener('change', function() {
            document.getElementById('return_date').setAttribute('min', this.value);
        });
    });
</script>
{% endblock %}